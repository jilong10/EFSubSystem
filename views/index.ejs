<% include ./partials/header %>

<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.min.js"></script>
<div class="row">
	<div class="status animated fadeInDown">	
		<% data.Crisis.forEach(crisis => { %>	
		<div class="row">			
			<div class="col-lg-6">
				<h1>Current Status</h1>				
			</div>			
		</div>	
		<div class="row">
			<div class="col-lg-10 col-md-8">
				<button type="button" class="btn btn-primary">Send Status Update</button>			
			</div>			
		</div>
		<% }); %>	
	</div>	
</div>

<div class="card mb-3 animated fadeInUpBig">
	<div class="card-header">
		<% data.Crisis.forEach(crisis => { %>	
		<div class="row">
			<div class="col-lg-8">
				<h1>
					Code 													
					<% if (String(crisis.crisisCode).toUpperCase() == 'GREEN') { %>
						<span class="badge badge-secondary green"><%= crisis.crisisCode %></span>
					<% } else if (String(crisis.crisisCode).toUpperCase() == 'YELLOW') { %>
						<span class="badge badge-secondary yellow"><%= crisis.crisisCode %></span>
					<% } else if (String(crisis.crisisCode).toUpperCase() == 'RED') { %>
						<span class="badge badge-danger"><%= crisis.crisisCode %></span>
					<% } %>									
				</h1>				
			</div>
			<div class="col-auto">
				<h1>
					<button type="button" class="btn btn-secondary">
						Injuries <span class="badge badge-light"><label class="unit-label"><%= crisis.noOfInjuries %></label></span>
					</button>
					<button type="button" class="btn btn-dark">
						Deaths <span class="badge badge-light"><label class="unit-label"><%= crisis.noOfDeaths %></label></span>
					</button>
				</h1>
			</div>
		</div>	
		<% }); %>			
	</div>	
	<div class="card-body">
		<div class="row">
			<div class="col-md-6">
				<canvas id="myDoughnutChart" width="100" height="100"></canvas>
			</div>
			<div class="col-md-6">
				<canvas id="myDoughnutChart2" width="100" height="100"></canvas>
			</div>
		</div>
	</div>
</div>

<script>
	var ctx = document.getElementById("myDoughnutChart");
	//Total Deployed Units
	var myLineChart = new Chart(ctx, {
	  type: 'doughnut',
	  data: {
			datasets: [
			{
					data: [
						<% data.DeploymentUnit.forEach(deploymentunit => { %>
						<%= deploymentunit.currentUnitSize + deploymentunit.unitCasualty%>,
						<% }); %>
					],
					backgroundColor: [
						<% data.DeploymentUnit.forEach(deploymentunit => { 
							if (String(deploymentunit.unitType).toUpperCase() === 'AIR') { %>
								"rgba(228, 241, 254, 0.7)",
							<% } else if (String(deploymentunit.unitType).toUpperCase() === 'SEA') { %>
								"rgba(68, 108, 179, 0.7)",
							<% } else if (String(deploymentunit.unitType).toUpperCase() === 'LAND') { %>								
								"rgba(27, 188, 155, 0.7)",
							<% } else if (String(deploymentunit.unitType).toUpperCase() === 'QUARANTINE') { %>								
								"rgba(247, 202, 24, 0.7)",
							<% } else if (String(deploymentunit.unitType).toUpperCase() === 'CLEANUP') { %>								
								"rgba(108, 122, 137, 0.7)",
							<% } %>
						<% }); %>
					],
					label: "Total Deployed"
			},
		

					
		],
			labels: [
				<% data.DeploymentUnit.forEach(deploymentunit => { %>
				"<%= deploymentunit.unitName %>",
				<% }); %>
			]},
			options: {
				responsive: true,
				legend: {
					position: 'top',
				},
				title: {
					display: true,
					text: 'Total Deployed Units'
				},
				animation: {
					animateScale: true,
					animateRotate: true
				}
			}
		}
	);
	
	//Enemy Units
	var ctx = document.getElementById("myDoughnutChart2");
	var myLineChart = new Chart(ctx, {
	  type: 'doughnut',
	  data: {
			datasets: [{
					data: [
						<% data.Crisis.forEach(crisis => { %>
							<% crisis.Enemy.forEach(enemy => { %>
								<%= enemy.enemySize %>,
							<% }); %>
						<% }); %>
					],
					backgroundColor: [
						<% data.Crisis.forEach(crisis => { 
							crisis.Enemy.forEach(enemy => {
								if (String(enemy.enemyType).toUpperCase() === 'AIR') { %>
									"rgba(228, 241, 254, 0.7)",
								<% } else if (String(enemy.enemyType).toUpperCase() === 'SEA') { %>
									"rgba(68, 108, 179, 0.7)",
								<% } else if (String(enemy.enemyType).toUpperCase() === 'LAND') { %>								
									"rgba(27, 188, 155, 0.7)",
								<% } %>
							<% }); %>							
						<% }); %>
					],
					label: [
						<% data.Crisis.forEach(crisis => { %>
							<% crisis.Enemy.forEach(enemy => { %>
								"<%= enemy.enemyName %>",
							<% }); %>
						<% }); %>
					]
				}],
			labels: [
				<% data.Crisis.forEach(crisis => { %>
					<% crisis.Enemy.forEach(enemy => { %>
						"<%= enemy.enemyName %>",
					<% }); %>
				<% }); %>
			]},
			options: {
				responsive: true,
				legend: {
					position: 'top',
				},
				title: {
					display: true,
					text: 'Total Enemies'
				},
				animation: {
					animateScale: true,
					animateRotate: true
				}
			}
		}
	);

</script>

<% include ./partials/footer %>